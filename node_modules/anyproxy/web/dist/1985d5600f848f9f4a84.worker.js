!function(e){function r(f){if(s[f])return s[f].exports;var l=s[f]={exports:{},id:f,loaded:!1};return e[f].call(l.exports,l,l.exports,r),l.loaded=!0,l.exports}var s={};return r.m=e,r.c=s,r.p="",r(0)}([function(e,r){"use strict";var s=[];self.FILTERED_RECORD_LIST=[];var f=500;self.currentStateData=[],self.filterStr="",self.canLoadMore=!1,self.updateQueryTimer=null,self.refreshing=!0,self.beginIndex=0,self.endIndex=self.beginIndex+f-1,self.IN_DIFF=!1;var l=function(e){var r=null;if(e){var s=e.replace(/\r\n/g,"\n").replace(/\n\n/g,"\n");s=s.replace(/\n*$/,""),"/"===s[0]&&"/"===s[s.length-1]&&(s=s.substring(1,s.length-2)),s=s.replace(/((.+)\n|(.+)$)/g,function(e,r,s){return s?"("+s+")|":"("+r+")"});try{r=new RegExp(s)}catch(e){console.error(e)}}return r};self.resetDisplayRecordIndex=function(){self.beginIndex=0,self.endIndex=self.beginIndex+f-1},self.getFilteredRecords=function(){return self.FILTERED_RECORD_LIST},self.calculateFilteredRecords=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],f=l(self.filterStr);if(e){self.FILTERED_RECORD_LIST=[];for(var t=s.length,n=0;n<t;n++){var d=s[n];(!f||f&&f.test(d.url))&&self.FILTERED_RECORD_LIST.push(d)}}else r.forEach(function(e){var r=self.FILTERED_RECORD_LIST.findIndex(function(r){return e.id===r.id});r>=0?self.FILTERED_RECORD_LIST[r]=e:(!f||f&&f.test(e.url))&&self.FILTERED_RECORD_LIST.push(e)})},self.diffRecords=function(){if(!self.IN_DIFF){self.IN_DIFF=!0;var e=!1,r=self.getFilteredRecords();self.refreshing?(self.beginIndex=r.length-1-f,self.endIndex=r.length-1):self.endIndex>r.length&&(self.endIndex=r.length);var s=r.slice(self.beginIndex,self.endIndex+1),l=self.currentStateData.length,t=s.length;if(t!==l)e=!0;else for(var n=0;n<l;n++){var d=self.currentStateData[n],a=s[n];if(d.id!==a.id||a._render===!0){e=!0;break}}self.currentStateData=s,self.postMessage(JSON.stringify({type:"updateData",shouldUpdateRecord:e,recordList:s})),self.IN_DIFF=!1}},self.checkNewRecordsTip=function(){if(!self.IN_DIFF){var e=self.getFilteredRecords().length;self.postMessage(JSON.stringify({type:"updateTip",data:e-self.endIndex>0}))}},self.updateSingle=function(e){s.forEach(function(e){e._render=!1});var r=s.findIndex(function(r){return r.id===e.id});r>=0?(e._render=!0,s[r]=e):s.push(e),self.calculateFilteredRecords(!1,[e])},self.updateMultiple=function(e){s.forEach(function(e){e._render=!1}),e.forEach(function(e){var r=s.findIndex(function(r){return r.id===e.id});r>=0?(e._render=!0,s[r]=e):s.push(e)}),self.calculateFilteredRecords(!1,e)},self.addEventListener("message",function(e){var r=JSON.parse(e.data);switch(r.type){case"diff":self.diffRecords();break;case"updateQuery":r.filterStr!==self.filterStr&&(self.updateQueryTimer&&clearTimeout(self.updateQueryTimer),self.updateQueryTimer=setTimeout(function(){self.resetDisplayRecordIndex(),self.filterStr=r.filterStr,self.calculateFilteredRecords(!0),self.diffRecords()},150));break;case"updateSingle":self.updateSingle(r.data),self.refreshing?self.diffRecords():self.checkNewRecordsTip();break;case"updateMultiple":self.updateMultiple(r.data),self.refreshing?self.diffRecords():self.checkNewRecordsTip();break;case"initRecord":s=r.data,self.calculateFilteredRecords(!0),self.diffRecords();break;case"clear":s=[],self.calculateFilteredRecords(!0),self.diffRecords();break;case"loadMore":if(self.IN_DIFF)return;self.refreshing=!1,r.data>0?self.endIndex+=r.data:self.beginIndex=Math.max(self.beginIndex+r.data,0),self.diffRecords();break;case"updateRefreshing":"boolean"==typeof r.refreshing&&(self.refreshing=r.refreshing,self.refreshing&&self.diffRecords())}})}]);